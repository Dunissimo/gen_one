# DAO Венчурного Фонда - Быстрый старт для разработчика

## 📊 Архитектура на одной странице

```
┌─────────────────────────────────────────────────────────────────┐
│                    DAO ВЕНЧУРНОГО ФОНДА                         │
└─────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────┐
│ СЛОЙ 1: ТОКЕНЫ                                                   │
├──────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────┐  ┌─────────────────────┐                │
│ │  Professional (PROFI)│  │  RTKCoin (RTK)      │                │
│ │  ─────────────────  │  │  ─────────────────  │                │
│ │ Supply: 100k        │  │ Supply: 20M         │                │
│ │ Decimals: 12        │  │ Decimals: 12        │                │
│ │ Transfer: ❌ ЗАПРЕЩ │  │ Transfer: ✅ OK     │                │
│ │ Конверсия:          │  │ Конверсия:          │                │
│ │  3 PROFI = 1 голос  │  │  6 RTK = 1 голос    │                │
│ │  1 PROFI ≠ передачи │  │  1 RTK = 1 ETH      │                │
│ └─────────────────────┘  └─────────────────────┘                │
└──────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────┐
│ СЛОЙ 2: УПРАВЛЕНИЕ                                               │
├──────────────────────────────────────────────────────────────────┤
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │                  ProposalManager                              │ │
│ │  • Создание proposals (6 типов A-F)                          │ │
│ │  • Контроль статусов (Pending → Active → Passed/Failed)      │ │
│ │  • Удаление proposals (до голосования)                       │ │
│ └──────────────────────────────────────────────────────────────┘ │
│                                                                    │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │                   VotingSystem                                │ │
│ │  • Преобразование токенов в голоса                          │ │
│ │  • Запись голосов (Against/For/Abstain)                     │ │
│ │  • Управление делегированием RTK                            │ │
│ └──────────────────────────────────────────────────────────────┘ │
│                                                                    │
│ ┌──────────────────────────────────────────────────────────────┐ │
│ │                 QuorumCalculator                              │ │
│ │  • SimpleM: 50% + 1 (для типов C, D, E, F)                 │ │
│ │  • SuperM: 2/3 (для типов C, D, E, F)                       │ │
│ │  • WeightVote: votesFor > votesAgainst (для типов A, B)     │ │
│ └──────────────────────────────────────────────────────────────┘ │
└──────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────┐
│ СЛОЙ 3: ИСПОЛНЕНИЕ                                               │
├──────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────┐  ┌─────────────────────┐                │
│ │    FundVault        │  │   FundGovernor      │                │
│ │  ─────────────────  │  │  ─────────────────  │                │
│ │ • Хранение ETH      │  │ • Главный контракт  │                │
│ │ • Инвестиции       │  │ • Оркестрирует всё  │                │
│ │ • История платежей  │  │ • Исполняет решения │                │
│ └─────────────────────┘  └─────────────────────┘                │
└──────────────────────────────────────────────────────────────────┘

                            ПОТОК ДАННЫХ
                                  ↓
                         ┌─────────────────┐
                         │  Блокчейн       │
                         │  (Ethereum)     │
                         │                 │
                         │  Все события    │
                         │  логируются     │
                         │  навечно        │
                         └─────────────────┘
```

---

## 🎯 Типы пользователей и права

```
┌────────────────────────────────────────────────────────┐
│ УРОВЕНЬ 1: Неавторизованный                           │
│ ┌─────────────────────────────────────────────────┐   │
│ │ • Может просматривать принятые proposals        │   │
│ │ • Может читать события                          │   │
│ │ • Не может взаимодействовать                    │   │
│ └─────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────┐
│ УРОВЕНЬ 2: Авторизован, НЕ участник DAO              │
│ ┌─────────────────────────────────────────────────┐   │
│ │ • Может купить RTK за ETH                       │   │
│ │ • Может делегировать голос участнику DAO       │   │
│ │ • Может просматривать активные proposals       │   │
│ │ ❌ НЕ может голосовать напрямую                 │   │
│ │ ❌ НЕ может создавать proposals                 │   │
│ └─────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────┘

┌────────────────────────────────────────────────────────┐
│ УРОВЕНЬ 3: Авторизован, УЧАСТНИК DAO                 │
│ ┌─────────────────────────────────────────────────┐   │
│ │ ✅ Имеет PROFI токены (25,000)                   │   │
│ │ ✅ Может создавать proposals (все 6 типов)      │   │
│ │ ✅ Может инициировать голосование              │   │
│ │ ✅ Может голосовать с PROFI + делегирован RTK  │   │
│ │ ✅ Может удалять свои proposals (до голосов)   │   │
│ │ ✅ Видит всех участников и их данные           │   │
│ │ ✅ Получает уведомления о результатах           │   │
│ └─────────────────────────────────────────────────┘   │
└────────────────────────────────────────────────────────┘
```

---

## 📋 Типы предложений (Proposals)

```
┌─────────────────────────────────────────────────────────────────┐
│ ТИП A: Инвестировать в НОВЫЙ стартап                          │
├─────────────────────────────────────────────────────────────────┤
│ Параметры: адрес_стартапа, сумма_ETH                          │
│ Кворум: ТОЛЬКО WeightVote (votesFor > votesAgainst)           │
│ Выполнение: Перевести ETH в адрес стартапа                    │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│ ТИП B: Доинвестировать в СУЩЕСТВУЮЩИЙ стартап                 │
├─────────────────────────────────────────────────────────────────┤
│ Параметры: адрес_стартапа, дополнит_сумма_ETH                │
│ Кворум: ТОЛЬКО WeightVote                                      │
│ Выполнение: Добавить инвестицию к существующей                │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│ ТИП C: Добавить нового участника DAO                           │
├─────────────────────────────────────────────────────────────────┤
│ Параметры: адрес_нового_участника                              │
│ Кворум: SimpleM (50%+1) ИЛИ SuperM (2/3)                       │
│ Выполнение: Выдать 25,000 PROFI новому члену                   │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│ ТИП D: Исключить участника из DAO                              │
├─────────────────────────────────────────────────────────────────┤
│ Параметры: адрес_участника                                     │
│ Кворум: SimpleM (50%+1) ИЛИ SuperM (2/3)                       │
│ Выполнение: Сжечь PROFI, удалить из членов                     │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│ ТИП E: Управление системным токеном PROFI                      │
├─────────────────────────────────────────────────────────────────┤
│ Параметры: параметры_для_PROFI (например, конверсия)          │
│ Кворум: SimpleM (50%+1) ИЛИ SuperM (2/3)                       │
│ Выполнение: Обновить параметр контракта                        │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│ ТИП F: Управление wrap-токеном RTK                             │
├─────────────────────────────────────────────────────────────────┤
│ Параметры: параметры_для_RTK (например, цена)                 │
│ Кворум: SimpleM (50%+1) ИЛИ SuperM (2/3)                       │
│ Выполнение: Обновить параметр контракта                        │
└─────────────────────────────────────────────────────────────────┘
```

---

## 💰 Расчеты конверсии

```
╔═══════════════════════════════════════════════════════════════╗
║              СИСТЕМА ГОЛОСОВАНИЯ И КОНВЕРСИИ                  ║
╠═══════════════════════════════════════════════════════════════╣
║                                                               ║
║  БАЗОВЫЙ ГОЛОС (DAO участник с PROFI):                       ║
║  ────────────────────────────────────────                    ║
║  • 3 PROFI = 1 голос                                          ║
║  • Пример: Tom имеет 25,000 PROFI                            ║
║    25,000 ÷ 3 = 8,333 голоса                                 ║
║                                                               ║
║  ДЕЛЕГИРОВАННЫЙ ГОЛОС (через RTK):                           ║
║  ────────────────────────────────────────                    ║
║  • 6 RTK = 1 голос                                            ║
║  • 1 RTK = 1 ETH (цена)                                       ║
║  • Пример: Jack покупает 6 RTK за 6 ETH                      ║
║    6 RTK ÷ 6 = 1 голос                                       ║
║                                                               ║
║  КУМУЛЯТИВНЫЙ ГОЛОС (участник + делегирование):             ║
║  ────────────────────────────────────────────                ║
║  • Ben имеет 25,000 PROFI = 8,333 голоса                     ║
║  • Jack делегирует ему 6 RTK = 1 голос                       ║
║  • Итого Ben может голосовать: 8,334 голоса                  ║
║                                                               ║
║  ВАЖНО:                                                       ║
║  • RTK блокируются на время голосования                       ║
║  • После голосования RTK возвращаются владельцу              ║
║  • PROFI НЕ может быть передано, только присутствие          ║
║  • Голосовать могут ТОЛЬКО участники DAO                     ║
║                                                               ║
╚═══════════════════════════════════════════════════════════════╝
```

---

## ⏳ Жизненный цикл предложения

```
START
  ↓
┌─────────────┐
│   PENDING   │  ← Proposal создан, ждет инициирования
│             │     голосования
└─────────────┘
  ↓ (автор или инициатор: startVoting)
  ├─────────────┐
  │   CANCELED  │  ← Отменено до голосования (только автор)
  └─────────────┘
  │ (создатель не отменил)
  ↓
┌─────────────┐
│   ACTIVE    │  ← Голосование идет, люди голосуют
│             │     (votingStartTime → votingEndTime)
└─────────────┘
  ↓ (время истекло, любой вызывает finalizeVote)
  ├─────────────┐      ┌──────────────┐
  │   DEFEATED  │      │  SUCCEEDED   │
  └─────────────┘      └──────────────┘
  │                    │
  │ (не прошел         │ (прошел кворум)
  │  кворум)           │
  │                    ↓ (любой вызывает executeProposal)
  │                  ┌──────────────┐
  │                  │   EXECUTED   │
  │                  │              │
  │                  │ • Инвестиция → Стартап
  │                  │ • Участник добавлен/удален
  │                  │ • Параметры изменены
  │                  └──────────────┘
  │                    ↓
  └────────────────────END

КАЖДЫЙ СТАТУС ЗАПИСЫВАЕТСЯ НА БЛОКЧЕЙНЕ НАВЕЧНО
```

---

## 📊 Механизмы кворума

```
╔═════════════════════════════════════════════════════════════╗
║           МЕХАНИЗМ 1: ПРОСТОЕ БОЛЬШИНСТВО (50% + 1)        ║
╠═════════════════════════════════════════════════════════════╣
║ Используется для: Типы C, D, E, F (управление)             ║
║ Формула: votesFor >= (totalVotes ÷ 2) + 1                  ║
║                                                              ║
║ Пример:                                                      ║
║   Всего голосов: 100                                        ║
║   За: 51                                                     ║
║   Против: 49                                                 ║
║                                                              ║
║   Требуется: (100 ÷ 2) + 1 = 51 голос                       ║
║   Результат: 51 >= 51 → PASSED ✅                           ║
║                                                              ║
║ Граничный случай:                                           ║
║   Всего: 99, За: 50, Против: 49                             ║
║   Требуется: (99 ÷ 2) + 1 = 50                              ║
║   Результат: 50 >= 50 → PASSED ✅                           ║
╚═════════════════════════════════════════════════════════════╝

╔═════════════════════════════════════════════════════════════╗
║        МЕХАНИЗМ 2: СУПЕРБОЛЬШИНСТВО (2/3)                  ║
╠═════════════════════════════════════════════════════════════╣
║ Используется для: Типы C, D, E, F (альтернатива)          ║
║ Формула: votesFor >= ⌈(totalVotes × 2) ÷ 3⌉               ║
║                                                              ║
║ Пример:                                                      ║
║   Всего голосов: 100                                        ║
║   За: 67                                                     ║
║   Против: 33                                                 ║
║                                                              ║
║   Требуется: ⌈(100 × 2) ÷ 3⌉ = 67 голосов                 ║
║   Результат: 67 >= 67 → PASSED ✅                           ║
║                                                              ║
║ Граничный случай:                                           ║
║   Всего: 99, За: 66, Против: 33                             ║
║   Требуется: ⌈(99 × 2) ÷ 3⌉ = 66                           ║
║   Результат: 66 >= 66 → PASSED ✅                           ║
╚═════════════════════════════════════════════════════════════╝

╔═════════════════════════════════════════════════════════════╗
║        МЕХАНИЗМ 3: ГОЛОСА ПО ВЕСУ (ПРОСТОЕ БОЛЬШИНСТВО)   ║
╠═════════════════════════════════════════════════════════════╣
║ Используется для: Типы A, B (инвестиции)                   ║
║ Формула: votesFor > votesAgainst                            ║
║ ⚠️ БЕЗ минимума участников, просто больше голосов за       ║
║                                                              ║
║ Пример:                                                      ║
║   За: 16,667 голосов                                        ║
║   Против: 8,334 голосов                                     ║
║                                                              ║
║   Результат: 16,667 > 8,334 → PASSED ✅                    ║
║                                                              ║
║ Граничный случай:                                           ║
║   За: 1                                                      ║
║   Против: 0                                                  ║
║                                                              ║
║   Результат: 1 > 0 → PASSED ✅                             ║
║   (Даже один голос может пройти!)                           ║
╚═════════════════════════════════════════════════════════════╝
```

---

## 🚀 Быстрый старт Hardhat

```bash
# 1. Инициализировать проект
npx hardhat init

# 2. Установить зависимости
npm install @openzeppelin/contracts

# 3. Скомпилировать контракты
npx hardhat compile

# 4. Запустить тесты
npx hardhat test

# 5. Развернуть на тестнете (Sepolia)
npx hardhat run scripts/deploy.js --network sepolia

# 6. Проверить на etherscan
# https://sepolia.etherscan.io/address/0x...
```

---

## 📞 Связь с другими контрактами

```
Professional.sol
    ↓ использует
    ├─ ERC20 (OpenZeppelin)
    ├─ ERC20Votes (OpenZeppelin)
    └─ Ownable (OpenZeppelin)

RTKCoin.sol
    ↓ использует
    ├─ ERC20 (OpenZeppelin)
    └─ Ownable (OpenZeppelin)

FundVault.sol
    ↓ использует
    ├─ Ownable (OpenZeppelin)
    ├─ ReentrancyGuard (OpenZeppelin)
    └─ вызывается из FundGovernor

ProposalManager.sol
    ↓ использует
    └─ Ownable (OpenZeppelin)

VotingSystem.sol
    ↓ использует
    ├─ IERC20 (OpenZeppelin)
    └─ структуры данных

QuorumCalculator.sol
    ↓ использует
    └─ чистая логика вычисления

FundGovernor.sol (главный)
    ↓ оркестрирует и использует
    ├─ Professional.sol
    ├─ RTKCoin.sol
    ├─ FundVault.sol
    ├─ ProposalManager.sol
    ├─ VotingSystem.sol
    └─ QuorumCalculator.sol
```

---

## 🎯 Финальный чек-лист

```
ПЕРЕД РЕШЕНИЕМ:
☐ Знаю разницу между PROFI и RTK
☐ Понимаю 6 типов proposals
☐ Знаю все 3 механизма кворума
☐ Понимаю жизненный цикл proposal
☐ Знаю как работает делегирование

ПЕРЕД НАПИСАНИЕМ КОДА:
☐ Установлен Node.js и npm
☐ Инициализирован Hardhat проект
☐ Структура папок создана
☐ Зависимости установлены

ПЕРЕД ТЕСТИРОВАНИЕМ:
☐ Все контракты скомпилируются
☐ Нет ошибок синтаксиса
☐ Все импорты корректны
☐ Логика соответствует требованиям

ПЕРЕД СДАЧЕЙ:
☐ Все 7 контрактов реализованы
☐ Минимум 20 тестов написано
☐ Все тесты проходят
☐ Код задокументирован
☐ Deploy скрипт работает
```

---

**Готово к разработке! 🎉**
